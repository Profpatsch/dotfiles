#!/usr/bin/env nix-shell
#!nix-shell -i python3 -p libnotify python3

import sys
import glob
import subprocess as sub
import os.path as path
import statistics as st

full = 0
now  = 0
for bat in glob.iglob("/sys/class/power_supply/BAT*"):
    def readint(fn):
        with open(fn, 'r') as f:
            return int(f.read())

    full += readint(path.join(bat, "energy_full"))
    now  += readint(path.join(bat, "energy_now" ))

bat = round( now/full, 2 )
date = sub.run(["date", "+%T %a %d.%m."], stdout=sub.PIPE).stdout.strip().decode()
notify = "{} | BAT: {}".format(date, bat)

sub.run(["notify-send", notify])
